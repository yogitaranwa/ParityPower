<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parity Calculator</title>
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a427a; /* Tailwind slate-50 */
            background-image: url('edenburg.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .main-container {
            background-color: rgba(255, 255, 255, 0.9);
        }

        @media (min-width: 768px) {
            .main-container {
                background-color: rgb(255, 255, 255);
            }
        }
        @keyframes float-up {
            0%, 100% { transform: translateY(0); }
            50%      { transform: translateY(-20px); }
        }

        @keyframes float-down {
            0%, 100% { transform: translateY(0); }
            50%      { transform: translateY(20px); }
        }

        @keyframes float-left {
            0%, 100% { transform: translateX(0); }
            50%      { transform: translateX(-20px); }
        }

        @keyframes float-right {
            0%, 100% { transform: translateX(0); }
            50%      { transform: translateX(20px); }
        }

        @keyframes float-diag1 {
            0%, 100% { transform: translate(0,0); }
            50%      { transform: translate(20px,-20px); }
        }

        @keyframes float-diag2 {
            0%, 100% { transform: translate(0,0); }
            50%      { transform: translate(-20px,20px); }
        }

        /* Base floating */
        .float-up    { animation: float-up 6s ease-in-out infinite; }
        .float-down  { animation: float-down 6s ease-in-out infinite; }
        .float-left  { animation: float-left 6s ease-in-out infinite; }
        .float-right { animation: float-right 6s ease-in-out infinite; }
        .float-diag1 { animation: float-diag1 6s ease-in-out infinite; }
        .float-diag2 { animation: float-diag2 6s ease-in-out infinite; }

        /* Staggered delays */
        .delay-1 { animation-delay: 0s; }
        .delay-2 { animation-delay: 0.5s; }
        .delay-3 { animation-delay: 1s; }
        .delay-4 { animation-delay: 1.5s; }
        .delay-5 { animation-delay: 2s; }
        .delay-6 { animation-delay: 2.5s; }
    </style>
</head>
<body class="text-slate-800 min-h-screen flex flex-col items-center justify-center p-4">

    <main class="main-container w-full max-w-5xl rounded-3xl shadow-xl p-8 sm:p-12 flex flex-col md:flex-row items-start justify-between">

        <!-- Left side for content -->
        <div class="w-full md:w-1/2 flex flex-col items-start text-left md:pr-8">
            <!-- The PPP Logo -->
            <div class="flex items-center space-x-1 mb-4 md:mb-8">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-slate-900">Parity</h1>
                <!-- Corrected SVG with more tilt, increased size, and reduced spacing -->
                <svg class="w-14 h-14 sm:w-16 sm:h-16 text-yellow-500 transform rotate-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11 0L0 12h6l-1 12 11-12h-6L11 0z"/>
                </svg>
            </div>

            <p class="text-lg sm:text-xl text-slate-500 mb-8">
                The simplest way to calculate Purchasing Power Parity.
            </p>

            <!-- PPP Calculation UI -->
            <div class="w-full">
                <form id="ppp-form" class="space-y-6">
                    <div>
                        <label for="year" class="block text-sm font-medium text-slate-700">Data Year</label>
                        <select id="year" name="year" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 transition duration-200 ease-in-out hover:border-indigo-400">
                        </select>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                         <div>
                            <label for="salary-currency" class="block text-sm font-medium text-slate-700">Salary Currency</label>
                            <select id="salary-currency" name="salary-currency" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 transition duration-200 ease-in-out hover:border-indigo-400">
                                <!-- Currencies will be populated here -->
                            </select>
                        </div>
                        <div>
                            <label for="salary" class="block text-sm font-medium text-slate-700">Annual Salary</label>
                            <input type="number" id="salary" name="salary" required min="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 transition duration-200 ease-in-out hover:border-indigo-400" placeholder="e.g., 50000" />
                        </div>
                    </div>


                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="from-country" class="block text-sm font-medium text-slate-700">From Country</label>
                            <select id="from-country" name="from-country" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 transition duration-200 ease-in-out hover:border-indigo-400">
                            </select>
                        </div>
                        <div>
                            <label for="to-country" class="block text-sm font-medium text-slate-700">To Country</label>
                            <select id="to-country" name="to-country" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 transition duration-200 ease-in-out hover:border-indigo-400">
                            </select>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">
                            Calculate
                        </button>
                        <button type="button" id="clear-btn" class="w-full py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-slate-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">
                            Clear
                        </button>
                    </div>
                </form>

                <!-- Loading and Error UI -->
                <div id="loading" class="hidden mt-6 text-center text-slate-500">
                    <div class="animate-spin inline-block w-8 h-8 border-4 border-b-transparent rounded-full border-indigo-500"></div>
                    <p class="mt-2">Loading data...</p>
                </div>
                
                <div id="error-div" class="hidden mt-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl relative transition-all duration-300 ease-in-out">
                    <span id="error-message" class="block sm:inline"></span>
                </div>

                <!-- Results Section -->
                <div id="results-div" class="hidden mt-6 bg-green-100 p-6 rounded-3xl shadow-md transition-all duration-300 ease-in-out">
                    <h3 class="text-xl font-bold text-green-800 mb-2">Equivalent Purchasing Power:</h3>
                    <p class="text-4xl font-extrabold text-green-600 mb-4" id="result-text"></p>
                    <p class="text-sm text-green-700" id="result-info"></p>
                </div>
            </div>  
        </div>

        <!-- Right side for images -->
        <div class="w-full md:w-1/2 mt-8 md:mt-0 md:pl-8 flex justify-center items-center">
            <div class="grid grid-cols-2 gap-10">
                <img src="  6404d3e0cc877f4ba6fa55d85b68a999.jpg" 
                    alt="Taj Mahal"
                    class="w-40 h-40 object-cover rounded-full drop-shadow-[0_8px_8px_rgba(0,0,0,0.8)] float-up delay-1" />

                <img src="  Disneyland.jpg" 
                    alt="Burj Khalifa"
                    class="w-40 h-40 object-cover rounded-full drop-shadow-[0_8px_8px_rgba(0,0,0,0.8)] float-down delay-2" />

                <img src="  60169a2295c4f68b8fe797d4d307bcaa.jpg" 
                    alt="Eiffel Tower"
                    class="w-40 h-40 object-cover rounded-full drop-shadow-[0_8px_8px_rgba(0,0,0,0.8)] float-up delay-3" />

                <img src="  Burjkhalifa.jpg" 
                    alt="Statue of Liberty"
                    class="w-40 h-40 object-cover rounded-full drop-shadow-[0_8px_8px_rgba(0,0,0,0.8)] float-down delay-4" />

                <img src="  Disneyland.jpg" 
                    alt="Edenburg"
                    class="w-40 h-40 object-cover rounded-full drop-shadow-[0_8px_8px_rgba(0,0,0,0.8)] float-up delay-5" />

                <img src="  edenburg.jpg" 
                    alt="Swiss Alps"
                    class="w-40 h-40 object-cover rounded-full drop-shadow-[0_8px_8px_rgba(0,0,0,0.8)] float-down delay-6" />
            </div>
        </div>


    </main>

    <!-- The Calculator Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('ppp-form');
            const yearSelect = document.getElementById('year');
            const salaryCurrencySelect = document.getElementById('salary-currency');
            const fromCountrySelect = document.getElementById('from-country');
            const toCountrySelect = document.getElementById('to-country');
            const resultsDiv = document.getElementById('results-div');
            const resultText = document.getElementById('result-text');
            const resultInfo = document.getElementById('result-info');
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error-div');
            const errorMessage = document.getElementById('error-message');
            const clearBtn = document.getElementById('clear-btn');
            
            const API_KEY_EXCHANGE_RATE = 'YOUR_API_KEY_HERE'; // Replace with your key if using a different API

            let pppData = {};
            let exchangeRates = {};

            // A manual mapping of countries to currency codes, as APIs don't always provide this
            const countryToCurrencyMap = {
                "Aruba": "AWG", "Afghanistan": "AFN", "Angola": "AOA", "Albania": "ALL", "Andorra": "EUR",
                "United Arab Emirates": "AED", "Argentina": "ARS", "Armenia": "AMD", "American Samoa": "USD",
                "Antigua and Barbuda": "XCD", "Australia": "AUD", "Austria": "EUR", "Azerbaijan": "AZN",
                "Burundi": "BIF", "Belgium": "EUR", "Benin": "XOF", "Burkina Faso": "XOF", "Bangladesh": "BDT",
                "Bulgaria": "BGN", "Bahrain": "BHD", "Bahamas, The": "BSD", "Bosnia and Herzegovina": "BAM",
                "Belarus": "BYN", "Belize": "BZD", "Bermuda": "BMD", "Bolivia": "BOB", "Brazil": "BRL",
                "Barbados": "BBD", "Brunei Darussalam": "BND", "Bhutan": "BTN", "Botswana": "BWP",
                "Central African Republic": "XAF", "Canada": "CAD", "Switzerland": "CHF", "Chile": "CLP",
                "China": "CNY", "Cote d'Ivoire": "XOF", "Cameroon": "XAF", "Congo, Dem. Rep.": "CDF",
                "Congo, Rep.": "XAF", "Colombia": "COP", "Comoros": "KMF", "Cabo Verde": "CVE",
                "Costa Rica": "CRC", "Cuba": "CUP", "Curacao": "ANG", "Cyprus": "EUR",
                "Czechia": "CZK", "Germany": "EUR", "Djibouti": "DJF", "Dominica": "XCD",
                "Denmark": "DKK", "Dominican Republic": "DOP", "Algeria": "DZD", "Ecuador": "USD",
                "Egypt, Arab Rep.": "EGP", "Eritrea": "ERN", "Spain": "EUR", "Estonia": "EUR",
                "Ethiopia": "ETB", "Finland": "EUR", "Fiji": "FJD", "France": "EUR",
                "Micronesia, Fed. Sts.": "USD", "Gabon": "XAF", "United Kingdom": "GBP", "Georgia": "GEL",
                "Ghana": "GHS", "Gibraltar": "GIP", "Guinea": "GNF", "Gambia, The": "GMD",
                "Guinea-Bissau": "XOF", "Equatorial Guinea": "XAF", "Greece": "EUR", "Grenada": "XCD",
                "Greenland": "DKK", "Guatemala": "GTQ", "Guam": "USD", "Guyana": "GYD",
                "Hong Kong SAR, China": "HKD", "Honduras": "HNL", "Croatia": "EUR", "Haiti": "HTG",
                "Hungary": "HUF", "Indonesia": "IDR", "Isle of Man": "GBP", "India": "INR",
                "Ireland": "EUR", "Iran, Islamic Rep.": "IRR", "Iraq": "IQD", "Iceland": "ISK",
                "Israel": "ILS", "Italy": "EUR", "Jamaica": "JMD", "Jordan": "JOD", "Japan": "JPY",
                "Kazakhstan": "KZT", "Kenya": "KES", "Kyrgyz Republic": "KGS", "Cambodia": "KHR",
                "Kiribati": "AUD", "St. Kitts and Nevis": "XCD", "Korea, Rep.": "KRW", "Kuwait": "KWD",
                "Lao PDR": "LAK", "Lebanon": "LBP", "Liberia": "LRD", "Libya": "LYD",
                "St. Lucia": "XCD", "Liechtenstein": "CHF", "Sri Lanka": "LKR", "Lesotho": "LSL",
                "Lithuania": "EUR", "Luxembourg": "EUR", "Latvia": "EUR", "Macao SAR, China": "MOP",
                "St. Martin (French part)": "EUR", "Morocco": "MAD", "Monaco": "EUR",
                "Moldova": "MDL", "Madagascar": "MGA", "Maldives": "MVR", "Mexico": "MXN",
                "Marshall Islands": "USD", "Mali": "XOF", "Malta": "EUR", "Montenegro": "EUR",
                "Mongolia": "MNT", "Mozambique": "MZN", "Mauritius": "MUR", "Malawi": "MWK",
                "Malaysia": "MYR", "Namibia": "NAD", "Niger": "XOF", "Nigeria": "NGN",
                "Nicaragua": "NIO", "Netherlands": "EUR", "Norway": "NOK", "Nepal": "NPR",
                "New Zealand": "NZD", "Oman": "OMR", "Pakistan": "PKR", "Panama": "PAB",
                "Peru": "PEN", "Philippines": "PHP", "Palau": "USD", "Papua New Guinea": "PGK",
                "Poland": "PLN", "Portugal": "EUR", "Paraguay": "PYG", "Qatar": "QAR",
                "Kosovo": "EUR", "Romania": "RON", "Russian Federation": "RUB", "Rwanda": "RWF",
                "Saudi Arabia": "SAR", "Solomon Islands": "SBD", "Seychelles": "SCR", "Sudan": "SDG",
                "Sweden": "SEK", "Singapore": "SGD", "Slovenia": "EUR", "Slovak Republic": "EUR",
                "Sierra Leone": "SLL", "Senegal": "XOF", "Somalia": "SOS", "South Sudan": "SSP",
                "Sao Tome and Principe": "STN", "El Salvador": "USD", "Syrian Arab Republic": "SYP",
                "Eswatini": "SZL", "Chad": "XAF", "Togo": "XOF", "Thailand": "THB",
                "Tajikistan": "TJS", "Turkmenistan": "TMT", "Timor-Leste": "USD",
                "Tonga": "TOP", "Trinidad and Tobago": "TTD", "Tunisia": "TND", "Turkiye": "TRY",
                "Tuvalu": "AUD", "Tanzania": "TZS", "Uganda": "UGX", "Ukraine": "UAH",
                "United States": "USD", "Uruguay": "UYU", "Uzbekistan": "UZS", "Vanuatu": "VUV",
                "Venezuela, RB": "VES", "Vietnam": "VND", "Virgin Islands (U.S.)": "USD",
                "Samoa": "WST", "Yemen, Rep.": "YER", "South Africa": "ZAR", "Zambia": "ZMW",
                "Zimbabwe": "ZWL"
            };

            // Helper function for exponential backoff retry logic
            const fetchWithRetry = async (url, options = {}, retries = 3, delay = 1000) => {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (!response.ok) {
                            if (response.status === 429 && i < retries - 1) { // Too Many Requests
                                await new Promise(res => setTimeout(res, delay));
                                delay *= 2;
                                continue;
                            }
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return await response.json();
                    } catch (error) {
                        if (i === retries - 1) {
                            throw error;
                        }
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2;
                    }
                }
            };

            const displayError = (message) => {
                errorDiv.classList.remove('hidden');
                errorMessage.textContent = message;
                loadingDiv.classList.add('hidden');
                resultsDiv.classList.add('hidden');
            };

            const populateYearSelect = () => {
                const currentYear = new Date().getFullYear();
                for (let i = currentYear; i >= 2018; i--) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    if (i === currentYear) {
                        option.selected = true;
                    }
                    yearSelect.appendChild(option);
                }
                yearSelect.addEventListener('change', fetchPPPData);
            };

            const fetchPPPData = async () => {
                loadingDiv.classList.remove('hidden');
                errorDiv.classList.add('hidden');
                resultsDiv.classList.add('hidden');
                
                const year = yearSelect.value;
                const api_url = `https://api.worldbank.org/v2/country/all/indicator/PA.NUS.PPP?format=json&per_page=1000&date=${year}`;

                try {
                    const data = await fetchWithRetry(api_url);
                    // Check if the returned data is an array and if the second element exists and is an array
                    if (data && data[1] && Array.isArray(data[1])) {
                        pppData = {}; // Clear old data
                        data[1].forEach(item => {
                            if (item.value && item.country.value) {
                                pppData[item.country.value] = item.value;
                            }
                        });
                        populateCountrySelects();
                    } else {
                        displayError('Failed to load PPP data for this year. Please try a different year.');
                    }
                } catch (error) {
                    console.error('Error fetching PPP data:', error);
                    displayError('Failed to fetch data from the World Bank. Please check your network connection.');
                } finally {
                    loadingDiv.classList.add('hidden');
                }
            };

            const populateCountrySelects = () => {
                if (Object.keys(pppData).length === 0) {
                    return; // Don't populate if there's no data
                }
                const countryNames = Object.keys(pppData).sort();
                fromCountrySelect.innerHTML = '<option value="" disabled selected>Select a country</option>';
                toCountrySelect.innerHTML = '<option value="" disabled selected>Select a country</option>';

                countryNames.forEach(country => {
                    const optionFrom = document.createElement('option');
                    optionFrom.value = country;
                    optionFrom.textContent = country;
                    fromCountrySelect.appendChild(optionFrom);

                    const optionTo = document.createElement('option');
                    optionTo.value = country;
                    optionTo.textContent = country;
                    toCountrySelect.appendChild(optionTo);
                });
            };

            const fetchExchangeRates = async () => {
                try {
                    const response = await fetchWithRetry('https://api.exchangerate-api.com/v4/latest/USD');
                    exchangeRates = response.rates;
                    populateCurrencySelect();
                } catch (error) {
                    console.error('Error fetching exchange rates:', error);
                    displayError('Failed to load exchange rates. The calculator will only work with USD.');
                }
            };

            const populateCurrencySelect = () => {
                const currencies = Object.keys(exchangeRates).sort();
                currencies.forEach(currency => {
                    const option = document.createElement('option');
                    option.value = currency;
                    option.textContent = currency;
                    salaryCurrencySelect.appendChild(option);
                });
                salaryCurrencySelect.value = 'USD';
            };

            const calculatePPP = (salary, currency, fromCountry, toCountry) => {
                const fromPPP = pppData[fromCountry];
                const toPPP = pppData[toCountry];
                const toCountryCurrency = countryToCurrencyMap[toCountry];

                if (!fromPPP || !toPPP) {
                    displayError('Could not find PPP data for the selected countries.');
                    return;
                }
                
                if (!exchangeRates[currency]) {
                     displayError(`Could not find exchange rate for the selected currency: ${currency}.`);
                    return;
                }

                if (!toCountryCurrency || !exchangeRates[toCountryCurrency]) {
                     displayError(`Could not find currency data for the destination country: ${toCountry}.`);
                    return;
                }
                
                // Convert initial salary to USD
                const salaryInUSD = salary / exchangeRates[currency];

                // Calculate equivalent salary in USD based on PPP
                const equivalentSalaryInUSD = (salaryInUSD / fromPPP) * toPPP;

                // Convert the equivalent salary from USD to the destination country's currency
                const finalEquivalentSalary = equivalentSalaryInUSD * exchangeRates[toCountryCurrency];
                
                // Format the final result
                const formattedResult = finalEquivalentSalary.toLocaleString('en-US', {
                    style: 'currency',
                    currency: toCountryCurrency
                });

                resultText.textContent = formattedResult;
                resultInfo.textContent = `An annual salary of ${Number(salary).toLocaleString()} ${currency} in ${fromCountry} has a purchasing power equivalent to an annual salary of ${formattedResult} in ${toCountry}.`;

                resultsDiv.classList.remove('hidden');
                resultsDiv.scrollIntoView({ behavior: 'smooth' });
            };

            const clearForm = () => {
                form.reset();
                resultsDiv.classList.add('hidden');
                errorDiv.classList.add('hidden');
            };

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                errorDiv.classList.add('hidden');
                resultsDiv.classList.add('hidden');
                
                const salary = document.getElementById('salary').value;
                const currency = salaryCurrencySelect.value;
                const fromCountry = fromCountrySelect.value;
                const toCountry = toCountrySelect.value;

                if (salary <= 0 || fromCountry === "" || toCountry === "" || currency === "") {
                    displayError('Please enter a valid salary, select a currency, and select both countries.');
                    return;
                }

                if (fromCountry === toCountry) {
                    displayError('Please select two different countries.');
                    return;
                }

                calculatePPP(salary, currency, fromCountry, toCountry);
            });

            clearBtn.addEventListener('click', clearForm);

            // Initial data population
            populateYearSelect();
            fetchPPPData();
            fetchExchangeRates();
        });
    </script>
</body>
</html>
